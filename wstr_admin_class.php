<?phpclass WSTR_Admin{    protected static $instance = null;    function __construct(){        require_once(__DIR__. '/includes/wstr_library.php');        add_action("admin_enqueue_scripts", array($this, "wstr_load_admin_scripts"));        add_action("admin_enqueue_scripts", array($this, "wstr_load_admin_styles"));        add_action('add_meta_boxes', array($this, 'wstr_meta_boxes'));        add_action('add_meta_boxes', array($this, 'wstr_admin_meta_boxes'));        add_action('post_updated', array($this, 'wstr_save_meta'));		add_action("admin_enqueue_scripts", array($this, 'open_media'));    }    /*open media*/	 public function open_media(){		 if(!did_action('wp_enqueue_media')){			 wp_enqueue_media();		 }	 }	/*save settings*/    public function wstr_save_meta($post_id){        global $post;        if(get_post_type() === "wstr") {            $post_id = $post->ID;            $elem_width       = WSTR_library::validate_number($_POST['elem_width']);            $elem_height      = WSTR_library::validate_number($_POST['elem_height']);            $window_max_width = WSTR_library::validate_number($_POST['window_max_width']);            $button_margin    = WSTR_library::validate_number($_POST['button_margin']);            $elem_speed       = WSTR_library::validate_number($_POST['elem_speed']);            $button_style     = WSTR_library::validate_string($_POST['text_button_style']);            $button_position  = WSTR_library::validate_string($_POST['button_position']);            $post_page        = WSTR_library::validate_string($_POST['post_page']);            if ($_POST['text_button_style'] == 'image') {                $img_url = WSTR_library::validate_string($_POST['img_url']);                $arr     = array(                    'width' => $elem_width,                    'height' => $elem_height,                    'button_style' => $button_style,                    'img_url' => $img_url,                    'button_margin' => $button_margin,                    'window_max_width' => $window_max_width,                    'button_position' => $button_position,                    'elem_speed' => $elem_speed,                );                update_post_meta($post_id, 'wstr_scroll_top', $arr);            } else if ($_POST['text_button_style'] == 'text') {                $elem_text    = WSTR_library::validate_string($_POST['text_value']);                $elem_color   = WSTR_library::validate_hex_color($_POST['text_color']);                $elem_bgcolor = WSTR_library::validate_hex_color($_POST['text_bgcolor']);                $elem_border  = WSTR_library::validate_number($_POST['text_border']);                $arr = array(                    'width' => $elem_width,                    'height' => $elem_height,                    'elem_text' => $elem_text,                    'button_style' => $button_style,                    'elem_color' => $elem_color,                    'elem_bgcolor' => $elem_bgcolor,                    'elem_border' => $elem_border,                    'button_margin' => $button_margin,                    'window_max_width' => $window_max_width,                    'button_position' => $button_position,                    'elem_speed' => $elem_speed,                );                update_post_meta($post_id, 'wstr_scroll_top', $arr);            }            if ($post_page === 'on') {                update_post_meta($post_id, "wstr_scroll_top_pages", $post_page);            } else {                if (isset($_POST['page_id']) && is_array($_POST['page_id'])) {                    $roll_scroll_top_pages = array_map(array(                        'WSTR_library',                        'validate_page_id'                    ), $_POST["page_id"]);                    update_post_meta($post_id, "wstr_scroll_top_pages", $roll_scroll_top_pages);                }            }        }    }    public function wstr_load_admin_scripts(){        wp_enqueue_script('admin_js', plugins_url('/js/admin_js/admin_js.js', __FILE__),array('jquery'), ROLL_VERSION, true);        wp_enqueue_script('image_upload', plugins_url('/js/admin_js/image_upload.js', __FILE__),array('jquery'), ROLL_VERSION, true);    }    public function wstr_load_admin_styles(){        wp_enqueue_style('admin_css', plugins_url('/css/admin_css/admin_css.css', __FILE__), '', ROLL_VERSION);    }    /*admin_metabox*/    public function wstr_meta_boxes(){        add_meta_box(            'roll_meta_box',                // $id            'Scroll Settings',            // $title            array($this,'wstr_add_element_view'),   // $callback            'wstr',                     // $page            'normal',                  // $context            'high'                     // $priority        );    }    public function wstr_admin_meta_boxes(){        add_meta_box(            'roll_admin_meta_box',          // $id            'Page/Post',                  // $title            array($this,'wstr_choose_page_post'),   // $callback            'wstr',                     // $page            'normal',                  // $context            'high'                     // $priority        );    }    public function wstr_add_element_view(){        require_once('admin/admin_page.php');    }    public function wstr_choose_page_post(){        require_once('admin/admin_page_post.php');    }    /*admin_metabox*/    public static function get_instance() {        if (null == self::$instance) {            self::$instance = new self;        }        return self::$instance;    }}